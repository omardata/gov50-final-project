---
title: "Gov 50 Final Project"
author: "Omar Cano"
description: "My final project"
output:
  distill::distill_article:
    self_contained: false
---

Note to self.... Finish a simple analysis.. 
If there is time later, then come back and edit or add to it. By tonight, a draft that could be submitted. 
 

## 1 Introduction: introduce the research question and hypothesis and briefly describe why it is interesting (1-2 paragraphs) 
In this paper I will data relating voting patterns in international organizations to the level of aid that a country receives from the USA. I will look at how well a state's level of aid from the USA can explain that state's level of voting coincidence with the US in the United Nations General Assembly.??? Personal question: Is it voting coincidence, or is it state preference? What is the outcome variable? Might be able to use both...   

My  research question is:  Are the recipients of US aid more inclined to US-aligned voting in the UNGA? Does this aid change their state preference. This question is interesting because ___. 

My central hypothesis is that recipients of US aid vote more frequently in line with the US.This is interesting, as a hypothesis because ___.

A second hypothesis is that recipients of greater levels of US aid are more likely to vote in-line with the US than recepeints of lower amounts of US aid. 

The null hypothesis is that there any difference between the measure of US-voting coincidence and the amount of aid that a country receives is due to pure chance. 

## 2 Data Section ---------- Briefly describes the data source, describes how the key dependent and independent variables are measured (e.g., a survey, statistical model, or expert coding), and also produces a plot that summarizes the dependent variable) (2-3 paragraphs)

This paper relies on two data sources, one for the dependent variable and one for the independent variable.

My dependent variable, `distance`, is calculated from data of estimated measures of state preference as provided by Dreher et. all 2008. Dreher et all provide a numeric measure of state preference as calculated from United Nations General Assembly Voting Data(the variable `idealpointestimate`). This numeric measure of state-preference is given at a state/session level, that is it provides a single measure of state preference as calculated from United Nations General Assembly Voting Data for a given country in a given year. For a given session the distance of any two ideal-point estimates can be calculated by subtracting the values for two countries. Thus, my dependent variable `distance` is a measure of how aligned a given country is with the US a given session, arrived at by subtracting the value of the a given countries estimate from the USA ideal-point estimate for that year. The value for the US in any given year is zero, because the US displayed voting patterns identical to itself. Therefore a distance of zero means relatively similar voting patterns?

Data for my independent variable, `aid_committment`, is from  AidDataâ€™s Core Research Release Version 3.0. This data provides aggregated data (but also, they provide disaggreated data that is coded much more detail) on the amount of bilateral aid that a country reports that they committed to giving another country. This includes aid that was reported in __ and is given in constant dollars to  allow for time-series analysis. This variable is also reported at a recipient-year level, meaning that it provides the amount that was committed to a given state in a given year. It includes data from ____ to __ years.  




The data Dreher et al provide is the result of a statistical model derivedfrom Eric Voeten's data on member-state votes in the United Nations General Assembly. Dreher et als  arrive at what they call ideal-point estimates of state preferences. These esimates can be used to derive the  


I will explore differences between UNGA voting in the periods of ___. 
This data will be joined with data from AID, which gives data on bilateral aid commitments as reported by the donor governments. 

The data My variable of interest is the measure of alignment with the USA in the UNGA. The varible that I am using can be calculated from the ideal point estimations that are given by ___. This is a measure of the difference between the USA ideal point and a country's ideal point, for a given session. I have named this variable `distance` and it is what we are trying to explain, for a given country in a given year. The value for the US in a given year is zero, because the US displayed voting patterns identical to itself. Therefore a distance of zero means relatively similar voting patterns?  

My explanatory variable is whether, or how much aid a country receives from the US. This is measured in this study by the amoung of aid that a country has committed to give a country. This is measured in USD.


## Results--------- plot of main analysis + regression output + 2-3 paragraphs of description and interpretation of the plots and regression (including interpreting the main coefficient of interest and describing if it is statistically significant and if we should interpret it causally). This section could be longer if you choose to include additional analyses. (8pts)







## Conclusion






```{r loadata, echo = FALSE}
library(tidyverse)
library(dplyr)
install.packages("lubridate")
install.packages("countrycode")
library(lubridate)
library(countrycode)

load("~/Desktop/GOV 50/Projects/Final/final_project/data/un_votes.RData") ## 

ideal <-  read.csv("data/IdealpointestimatesAll_Jul2023.csv")
lead <- read_dta("data/WhyLeadersFightLEADDataset_updated.dta")
presidents <- read.csv("data/presidents.csv")

presidents <- presidents|>
  select(Presidency, President, Took.office, Left.office, Party)

View(ideal)
View(completeVotes)
View(presidents)
## Create the presidents tibble for dates. 

completeVotes|> summary()

```

## Ideal Points  
```{r}
## Can use a countries ideal point estimate? 
## Can use a fraction of the voting decisions? Maybe use the ideal points first, if time think about the raw voting data
View(ideal)

## Adding year from session 
ideal <- ideal|> mutate( country_cowc = countrycode(ccode, origin = 'cown' , destination = 'cowc'),
                         country_cown = ccode,
                         year_match = session + 1945)
## W/O USA
ideal_wo_us <- ideal|> 
  group_by(country_cown, year_match)|>
  select(ccode, session, IdealPointAll, Countryname, year_match, country_cown, country_cowc)|>
  filter(!country_cown == 2)

## US Values only
ideal_onlyus <- ideal|>
  filter(country_cown == 2)|>
  select(session, IdealPointAll)|>
  mutate(idealpoint_us = IdealPointAll)|>
  select(!IdealPointAll)

## idea now has US value
ideal<- ideal|> 
  left_join(ideal_onlyus, by = join_by(session))

ideal <- ideal|> 
  mutate(distance = idealpoint_us - IdealPointAll)|>
  mutate(distance_abs = abs(distance))

View(ideal_us)

## Familiarizing Self w data
ideal|> ggplot(mapping = aes(x = distance_abs))+
  geom_histogram()

ideal|> ggplot(mapping = aes(x = distance))+
  geom_histogram()

```


###Prepping Aid Data 
```{r}
## This is the aggregated data, can choose to use thes disaggregated later, if time 
aid <- read.csv("data/AidDataCoreDonorRecipientYear_ResearchRelease_Level1_v3.0.csv")
aid
## Got correct number of row? Yes. 

View(aid_us)

##gives data from 1973 to 2013 
aid_us <- aid|>
  filter(donor == "United States")

##Change from  recepient name to COW character country code, add COW numeric code for matching w Ideal point data
aid_us <- aid_us|> mutate( country = countrycode(recipient, origin = 'country.name', destination = 'cowc'))
aid_us <- aid_us|> mutate( country_cown = countrycode(country, origin = 'cowc', destination = 'cown'))

aid_us_test <- aid_us |> filter(is.na(country_cown))

## Testing Names, there are no names that are ambigously coded for COW C that show up in the UN voting data anyway, so there are no errors for COW N either 
unique(aid_us_test$recipient)
unique_names <- unique(cart$Countryname)
unique_names <- enframe(unique_names)
View(unique_names)
cart|> filter(Countryname == "Serbia")

## Aid US, changing date, PLUS on year. In order to use previous year's aid commitments to the vote year
aid_us <- aid_us |> mutate(year_match = year + 1)|> select(!year_lagged)

## Familiarizing Data.
aid_us|> ggplot(mapping = aes( x = year, y = commitment_amount_usd_constant_sum ))+
  geom_point()

country_amount <-aid_us |> 
   group_by(year_match)|> 
   summarize(num_countries  = length(unique(country_cown)),
             total_given = sum(commitment_amount_usd_constant_sum)) 
  
country_amount|>
  ggplot(mapping = aes(x = year_match,
                       y = num_countries))+
  geom_line()


country_amount|>
  ggplot(mapping = aes(x = year_match,
                       y = total_given))+
  geom_line()

 
```

## Merging Aid and Idea 
```{r}
View(ideal)
View(aid_us)

##Checking that UN is unique? Good. 
aid_us|>
  count(country_cown, year_match) |>
  filter(n > 1)

## Remove data for country_cown is N/A
aid_us <-  aid_us|>filter(!is.na(country_cown))

## Check that ideal point is unique? Good.
ideal|>
  count(country_cown, year_match) |>
  filter(n > 1)

##Joined Aid and Ideal
ideal_aid <- ideal|> 
  left_join(aid_us, join_by(country_cown, year_match))
View(ideal_aid)

ideal_aid |>filter(year_match > 1990,
                   commitment_amount_usd_constant_sum >1000000)|>
  ggplot(mapping = aes(x = commitment_amount_usd_constant_sum, 
                                  y = distance))+
  geom_point()

## Do ideal points need to be centered? 

```

















## Scrap Writing
I want to explore the extent to which there is state agreement on certain votes? 
The effect of something on voting coincidence in a particular time period and in a particular topic? 

The effect of political turn-over in the UNGA voting coincidence?
The role of leaders?
The role of some country-level feature?
 
 
Do small states agree more, do large states disagree more?
Democratic or Republican presidents at the UN?
Are there any statistical differences?



Which subset of states? 
Which votes, how to measure voting coincidence. Mutate,and create new variable that states coindidence or no coindidence. There are 

Domestic Turn-over, or... international factors.. 

 
What are valid and easy paper topics?
I just need either an easy GOV 50 paper, or an easy overlap between the GOV 50 paper and the UN paper. 

Do work on the UN paper first. Maybe whether or not there is an overlap. 


Can also just do a single-time analysis. 
Need something to test about the countries. '

```{r}
##Counting Number of Votes Total by Party
cart |> group_by(party)|>
  summarize(total = length(unique(rcid)))

##Mean Coincidence by Party
cart|> group_by(party)|>
  summarize(mean_coin = mean(weight_coin_us, na.rm = TRUE))

##Mean Coincidence per President
cart|> group_by(president)|>
summarize(mean_coin = mean(weight_coin_us, na.rm = TRUE))

##Maybe remove the israel votes? Maybe look at 
##Maybe look at who votes in line with the US most often?

cart|> group_by(Country, party)|>
  summarize(mean_coin_country = mean(weight_coin_us, na.rm = TRUE))|>
  pivot_wider(names_from = party, 
              values_from = mean_coin_country)|>
  mutate(ate = `Democrat` - `Republican`)|>
  ggplot(mapping = aes( y = ate))+
  geom_histogram()
```

```{r}
# Testing trump 
votes_trump<- completeVotes|>
  filter(year >= 2017)|>
  group_by(rcid)|> 
  summarize(mean = mean(vote ==1) )

votes_trump

View(completeVotes)

unique(completeVotes$year)
votes_trump|> summarize(mean = mean(mean))


votes_obama <- completeVotes|>
  filter(year < 2017 & year>2008)|>
  group_by(rcid)|> 
  summarize(mean = mean(vote ==1) )
votes_obama|> summarize (mean = mean(mean))


  group_by(rcid)|>
  summarize(mean_yes = mean(vote == 1))|>
  ggplot( mapping = aes( x =mean_yes))+
  geom_histogram(binwidth = .05)

## From LEAD data
lead_trump<- lead |> filter(year >= 2019)
lead
unique(lead_post1975$idacr)

```



```{r}
## Editing Dates on President's to Match UNGA Votes Format 
presidents <- presidents |> 
  mutate(left_office = as.Date(Left.office, format = "%d/%m/%Y"),
         took_office = as.Date(Took.office, format = "%d/%m/%Y"))

## Vote data to correct date format
completeVotes2 <- completeVotes|> mutate(
  date = as.Date(date, format = "%Y-%m-%d"))

View(completeVotes2)

##Subset UN Data, want only carter to Obama Votes
carter_obama <- completeVotes2|>
  filter( date > "1977-01-20" & date < "2017-01-20") ## needed to use just greater or lesser than

View(carter_obama)

##creating vector of democrat presidents 
democratic_indiators <- c("1", "4", "6")

##Assigning Presidency, Rep or Dem, and also president identifier 1 for carter, 2 for Reagan etc 
cart <- carter_obama|>
    mutate(pres_indicator = case_when( (date > "1977-01-20" & date < "1981-01-20") ~ "1",
                                       (date > "1981-01-20" & date < "1989-01-20") ~ "2",
                                       (date > "1989-01-20" & date < "1993-01-20") ~ "3",
                                       (date > "1993-01-20" & date < "2001-01-20") ~ "4",
                                       (date > "2001-01-20" & date < "2009-01-20") ~ "5",
                                       (date > "2009-01-20" & date < "2017-01-20") ~ "6")
           )|>
  mutate(democrat = if_else(pres_indicator %in% democratic_indiators, "1", "0"))|>
  mutate(party = if_else(democrat == 1, "Democrat", "Republican"))|>
  mutate(president = case_when(pres_indicator == 1 ~ "Jimmy Carter",
                               pres_indicator == 2 ~ "Ronald Reagan",
                               pres_indicator == 3 ~ "George H. W. Bush",
                               pres_indicator == 4 ~ "Bill Clinton",
                               pres_indicator == 5 ~ "George W. Bush",
                               pres_indicator == 6 ~ "Barack Obama")
  )

## Tibble of USA votes
us_votes <- cart|> 
  filter(Country == "USA")|>
  select(rcid, vote)|>
  mutate(us_vote = vote)|>
  select(!vote)

View(us_votes)

##Merge with all other votes, to indicate US vote in each row
cart <- cart |>
  left_join(us_votes, by = join_by(rcid))


## Adding Indicator of Voting With US or Not 
cart <- cart|> 
  mutate(coin_us = case_when((vote == 1 & us_vote == 1) | (vote ==3 & us_vote ==3) ~"Both Affirm/Deny",
                              vote %in% c("2","8") & us_vote %in% c("2","8") ~"Both Abstain/Absent",
                              (vote == 1 & us_vote ==2) | (vote == 2 & us_vote == 1) ~"Contra",
                             vote %in% c("2", "8") & us_vote %in% c("1", "2") ~ "Mixed"))

## Assigning Weights 
cart <- cart|> 
  mutate(weight_coin_us = case_when((vote == 1 & us_vote == 1) | (vote ==3 & us_vote ==3) ~ 1,
                              vote %in% c("2","8") & us_vote %in% c("2","8") ~ .5,
                              (vote == 1 & us_vote ==2) | (vote == 2 & us_vote == 1) ~0,
                             vote %in% c("2", "8") & us_vote %in% c("1", "2") ~ .5))

View(cart)


## Getting ATE per Country 
per_country_party <- cart|> 
  group_by(Country, party)|> 
  summarize(mean_country_coin = mean(weight_coin_us, na.rm = TRUE))|>
  pivot_wider(names_from = party,
              values_from = mean_country_coin)|>
  mutate( ate = `Democrat` - `Republican`)
  
View(per_country_party)



```